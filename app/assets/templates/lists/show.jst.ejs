<style>
  .list { list-style-type: none; margin: 0; padding: 0; float: left; margin-right: 10px; background: #eee; padding: 5px; width: 140px;}
  
  .new-list { list-style-type: none; margin: 0; padding: 0; float: left; margin-right: 10px; background: #eee; padding: 5px; width: 140px;}
  
  li.card { list-style-type: none; margin: 4px; float: center; background: #cdc9c9; padding: 5px; width: 130px;}
  
  .new-list-form {
    padding: 0px;
  }
  
  button.new-list-form {
    width: 100px;
    height: 20px;
  }
</style>


<script>
$(function() {
  $( '.list-container' ).sortable({
    // connectWith: "[data-id='list']",
    items: 'ul.list',
    tolerance: "pointer",
    stop: function(){
      var listOrder = [];
      $(this).children('ul.list').each(function(i, list){
        var list_id = $(list).data('list-id');
        listOrder.push(list_id);
      })
      $.ajax({
        type: 'POST',
        data: {list:listOrder},
        complete: function(request){
          // console.log(request)
        },
        url: 'lists/sort'
      })
    }
    // cancel: '.add-card',
    // helper: "clone",
  });
  
  $( "ul.list" ).sortable({
    connectWith: "ul.list",
    tolerance: "pointer",
    items: '.card',
  });
  
  // $( ".list" ).disableSelection();
  // $('.title-div').disableSelection();
    });
</script>

<!-- lists interation -->

<div class='list-container'>
  <!-- <tr> -->
    <% lists.each(function (list) { %>
      <!-- <td> -->
      <ul class="list" data-list-id='<%= list.id %>'>
        <header class='list-header'>
          <%= list.escape("title") %>
          <!-- card delete button -->
          <div class='delete-class' data-list-id='<%= list.id %>'>x</div>
        </header>
        <br>
        <div class='card'></div>
        <!-- cards iteration -->
        <% var cards = list.attributes.cards %>
        <% if(cards != undefined ){ %>
          <% cards.forEach(function(card) { %>
            <li class="card">
              <%= card.title || card.attributes.title %>
              <div class="delete-card" data-card-id='<%= card.id %>'>
                * delete
              </div> 
            </li> 
          <% }) %>
        <% } %>
      
        <!-- add a card div -->
        <div class='add-card'>
          <a class='add-card' href=''>add a card...</a>
          <div class='add-card-form add-card' style='display: none;'>
            <form data-list-id="<%= list.id %>" class='add-card-form add-card'>
              <input 
              class='add-card-form' 
              type='text' 
              name='card[title]' 
              placeholder='insert new card'>
    
              <input class='add-card-form' type='submit'>
            </form>
          </div>
        </div>
        
      </ul>
    <!-- </td> -->
    <% }); %>


<!-- add a list div -->
    <!-- <td> -->
      <div class='btn-large new-list'>
        Add a new list

        <div class='btn-large new-list-form' style="display: none;">
          <form class='new-list-form'>
          <input 
            class='new-list-form' 
            type='text' 
            name='list[title]' 
            placeholder='insert new title'>
            <input class='new-list-form' type='submit'>
          </form>
        </div>
      </div>
    <!-- </td> -->
  <!-- </tr> -->
</div>

